import{_ as ae,i as z,r as h,k as G,S as te,W as E,o as m,J as y,a,w as t,u as e,D as W,E as F,g as $,b as p,G as K,H as Q,v as I,L as ne,M as j,N as D,I as x,e as O,c as N,ae as oe,t as B,x as L,af as le,K as Y,O as X,V as Z,a0 as T,ag as se,B as ue,a1 as ie,Q as R,f as U,ac as q,ah as re,U as de,q as ce,m as me,n as pe,p as fe,s as ve,P as he,ai as be,R as _e,aj as Ce,T as ge,ad as ye}from"./index-4698ed6d.js";import{P as g,C as H,a as J}from"./AddContactModal.vue_vue_type_style_index_0_scoped_ca61ceab_lang-119f6f67.js";const Ie={class:"d-flex flex-column justify-content-space-between h-100"},we={__name:"AddContactModal",setup(ee){const V=z("axios"),P=h(""),i=h(!1),b=h(),o=h({phoneNumber:"",name:"",saveContact:!1}),w=h(!1),f=h([]),k=()=>T.dismiss(null,"cancel"),M=c=>{const l=c.target.value,C=l.replace(/[^0-9]/g,"");o.value.phoneNumber=C;const _=b.value;_!==void 0&&(_.$el.value=C);let u=!0;f.value=[],o.value.phoneNumber.length!==9&&(u=!1,f.value.push("Phone number must be 9 digits long")),o.value.phoneNumber.length===9&&!l.match(/^9/)&&(u=!1,f.value.push("Phone number must be a valid Portuguese mobile phone number")),o.value.phoneNumber.length===9&&l===P.value&&(u=!1,f.value.push("You cannot add yourself as a contact")),w.value=u},A=async()=>{i.value=!0;const c=await se.create({message:"Something went wrong. Please try again.",duration:1500,position:"bottom",color:"danger"});try{if(!(await V.get("vcards/".concat(o.value.phoneNumber,"/exists"))).data){f.value=["Phone number is not associated with a vCard"],await c.present(),i.value=!1;return}}catch(l){await c.present(),i.value=!1;return}(o.value.name==null||o.value.name=="")&&(o.value.name=o.value.phoneNumber),T.dismiss(o.value,"add"),o.value={phoneNumber:"",name:"",saveContact:!1},i.value=!1};return G(async()=>{const c=new te;await c.create(),P.value=await c.get("phone_number")}),(c,l)=>{const C=E("ion-card-content"),_=E("ion-card");return m(),y(Z,null,[a(e(Q),null,{default:t(()=>[a(e(W),null,{default:t(()=>[a(e(F),{slot:"start"},{default:t(()=>[a(e($),{color:"medium",onClick:l[0]||(l[0]=u=>k())},{default:t(()=>[p("Cancel")]),_:1})]),_:1}),a(e(K),null,{default:t(()=>[p("Add New Contact")]),_:1})]),_:1})]),_:1}),a(e(X),{class:"ion-padding"},{default:t(()=>[I("div",Ie,[a(e(ne),null,{default:t(()=>[a(e(j),null,{default:t(()=>[a(e(D),{size:"12"},{default:t(()=>[a(e(x),{position:"floating"},{default:t(()=>[p("Phone Number")]),_:1}),a(e(O),{type:"text",placeholder:"Enter a phone number",onIonInput:l[1]||(l[1]=u=>M(u)),maxlength:9,modelValue:o.value.phoneNumber,"onUpdate:modelValue":l[2]||(l[2]=u=>o.value.phoneNumber=u),ref_key:"ionInputPhoneElement",ref:b,disabled:i.value},null,8,["modelValue","disabled"]),f.value.length>0?(m(),N(e(oe),{key:0,color:"danger"},{default:t(()=>[p(B(f.value[0]),1)]),_:1})):L("",!0)]),_:1}),a(e(D),null,{default:t(()=>[a(e(x),{position:"floating"},{default:t(()=>[p("Name (optional)")]),_:1}),a(e(O),{type:"text",placeholder:"Enter a name",maxlength:30,modelValue:o.value.name,"onUpdate:modelValue":l[3]||(l[3]=u=>o.value.name=u),disabled:i.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(e(j),{class:"ion-justify-content-center",style:{"align-self":"self-end"}},{default:t(()=>[a(_,null,{default:t(()=>[a(C,{style:{display:"flex","flex-direction":"column","align-items":"center"}},{default:t(()=>[a(e(le),{disabled:!w.value||i.value,modelValue:o.value.saveContact,"onUpdate:modelValue":l[4]||(l[4]=u=>o.value.saveContact=u)},{default:t(()=>[p("Save contact in my contacts list")]),_:1},8,["disabled","modelValue"]),a(e($),{disabled:!w.value||i.value,onClick:A},{default:t(()=>[a(e(x),{class:"ion-label-w-spinner"},{default:t(()=>[p("Add Contact "),i.value?(m(),N(e(Y),{key:0})):L("",!0)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})])]),_:1})],64)}}},xe=ae(we,[["__scopeId","data-v-ca61ceab"]]),Ne={key:0,style:{height:"100%",width:"100%",display:"flex","align-items":"center","justify-content":"center"}},Pe={key:1},Ve=I("h1",null,"Add New Contact",-1),ke={key:0},Me=I("img",{alt:"",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1),Ae={key:1},Le={__name:"ContactList",setup(ee){const V=ue(),P=z("axios"),i=h(!0),b=h([]),o={name:{display:"Afonso Cancela"},phones:[{type:g.Mobile,label:"mobile",number:"918821097"}]},w={name:{display:"João Tavares"},phones:[{type:g.Mobile,label:"mobile",number:"900000001"}]},f={name:{display:"Miguel Pedrosa Alberto"},phones:[{type:g.Mobile,label:"mobile",number:"900000002"}]},k={name:{display:"João Miguel Antunes Carvalho da Silva"},phones:[{type:g.Mobile,label:"mobile",number:"900 000 003"}]},M=async()=>{const n={name:!0,phones:!0};return(await J.getContacts({projection:n})).contacts},A=async()=>{let n=[];return H.isNativePlatform()?n=await M():(console.log("web"),n=[o,w,f,k]),await C(n)},c=n=>{console.log(n),V.push({path:"/sendMoney/".concat(n.phone),query:{name:n.name}})},l=async()=>{const n=await T.create({component:xe});n.present();const{data:s,role:r}=await n.onWillDismiss(),S={name:{display:s.name,given:s.name,family:""},phones:[{type:g.Mobile,label:"mobile",number:s.phoneNumber}]},d=_(S,!0);if(r==="add"&&s.saveContact){const v={name:{display:s.name,given:s.name,family:""},phones:[{type:g.Mobile,label:"mobile",number:s.phoneNumber}]};i.value=!0,H.isNativePlatform()&&await J.createContact({contact:v}),b.value.push(d),i.value=!1}c(d)},C=async n=>{console.log(n);const s=n.filter(d=>d.phones).map(d=>{var v;return(v=d.phones[0])==null?void 0:v.number});s.forEach((d,v)=>{s[v]=d.replace(/\s/g,"")});const r=await u(s);return n.filter(d=>d.phones).map(d=>{var v;return _(d,r.includes((v=d.phones[0])==null?void 0:v.number.replace(/\s/g,"")))})},_=(n,s=!1)=>({name:n.name.display?n.name.display:"",phone:n.phones[0].number?n.phones[0].number.replace(/\s/g,""):"",isVcard:s}),u=async n=>(await P.get("/vcards/contacts",{params:{contacts:n}})).data.contacts;return G(async()=>{b.value=await A(),i.value=!1}),(n,s)=>(m(),N(e(he),null,{default:t(()=>[a(e(Q),null,{default:t(()=>[a(e(W),null,{default:t(()=>[a(e(F),{slot:"start"},{default:t(()=>[a(e(ie))]),_:1}),a(e(K),null,{default:t(()=>[p("Contacts")]),_:1})]),_:1})]),_:1}),a(e(X),null,{default:t(()=>[i.value?(m(),y("div",Ne,[a(e(Y),{style:{width:"100px",height:"100px"}})])):(m(),y("div",Pe,[I("div",null,[a(e(R),{inset:!0},{default:t(()=>[a(e(U),{onClick:l,button:!0},{default:t(()=>[a(e(q),{color:"success",slot:"start",icon:e(re),size:"large"},null,8,["icon"]),a(e(x),null,{default:t(()=>[Ve]),_:1})]),_:1})]),_:1})]),b.value.length>0?(m(),y("div",ke,[a(e(R),{inset:!0},{default:t(()=>[(m(!0),y(Z,null,de(b.value,r=>(m(),N(e(be),null,{default:t(()=>[r.name&&r.name.length>0&&r.phone&&r.phone.length>0?(m(),N(e(U),{key:0,button:!0,disabled:!r.isVcard,onClick:S=>c(r)},{default:t(()=>[_e(a(e(q),{"aria-hidden":"true",icon:e(Ce),color:"medium",slot:"end"},null,8,["icon"]),[[ge,r.isVcard]]),a(e(ye),{"aria-hidden":"true",slot:"start"},{default:t(()=>[Me]),_:1}),a(e(x),null,{default:t(()=>[I("h1",null,B(r.name),1),I("p",null,B(r.phone),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"])):L("",!0)]),_:2},1024))),256))]),_:1})])):(m(),y("div",Ae,[a(e(ce),null,{default:t(()=>[a(e(me),null,{default:t(()=>[a(e(pe),null,{default:t(()=>[p("No contacts")]),_:1}),a(e(fe))]),_:1}),a(e(ve),null,{default:t(()=>[p("Please add contacts to your contacts list")]),_:1})]),_:1})]))]))]),_:1})]),_:1}))}};export{Le as default};
