System.register(["./index-legacy-4ec23ca4.js","./AddContactModal.vue_vue_type_style_index_0_scoped_ca61ceab_lang-legacy-2d4833be.js"],(function(e,a){"use strict";var l,n,t,o,u,s,i,d,c,r,m,p,v,h,b,f,y,_,g,w,C,N,x,k,P,V,M,A,j,E,I,S,U,J,$,q,z,D,L,T,W,B,G,H,K,O,Q,R,Y,F,X,Z,ee,ae;return{setters:[e=>{l=e._,n=e.i,t=e.r,o=e.k,u=e.S,s=e.W,i=e.o,d=e.J,c=e.a,r=e.w,m=e.u,p=e.D,v=e.E,h=e.g,b=e.b,f=e.G,y=e.H,_=e.v,g=e.L,w=e.M,C=e.N,N=e.I,x=e.e,k=e.c,P=e.ae,V=e.t,M=e.x,A=e.af,j=e.K,E=e.O,I=e.V,S=e.a0,U=e.ag,J=e.B,$=e.a1,q=e.Q,z=e.f,D=e.ac,L=e.ah,T=e.U,W=e.q,B=e.m,G=e.n,H=e.p,K=e.s,O=e.P,Q=e.ai,R=e.R,Y=e.aj,F=e.T,X=e.ad},e=>{Z=e.P,ee=e.C,ae=e.a}],execute:function(){const a={class:"d-flex flex-column justify-content-space-between h-100"},le=l({__name:"AddContactModal",setup(e){const l=n("axios"),J=t(""),$=t(!1),q=t(),z=t({phoneNumber:"",name:"",saveContact:!1}),D=t(!1),L=t([]),T=async()=>{$.value=!0;const e=await U.create({message:"Something went wrong. Please try again.",duration:1500,position:"bottom",color:"danger"});try{if(!(await l.get(`vcards/${z.value.phoneNumber}/exists`)).data)return L.value=["Phone number is not associated with a vCard"],await e.present(),void($.value=!1)}catch(a){return await e.present(),void($.value=!1)}null!=z.value.name&&""!=z.value.name||(z.value.name=z.value.phoneNumber),S.dismiss(z.value,"add"),z.value={phoneNumber:"",name:"",saveContact:!1},$.value=!1};return o((async()=>{const e=new u;await e.create(),J.value=await e.get("phone_number")})),(e,l)=>{const n=s("ion-card-content"),t=s("ion-card");return i(),d(I,null,[c(m(y),null,{default:r((()=>[c(m(p),null,{default:r((()=>[c(m(v),{slot:"start"},{default:r((()=>[c(m(h),{color:"medium",onClick:l[0]||(l[0]=e=>S.dismiss(null,"cancel"))},{default:r((()=>[b("Cancel")])),_:1})])),_:1}),c(m(f),null,{default:r((()=>[b("Add New Contact")])),_:1})])),_:1})])),_:1}),c(m(E),{class:"ion-padding"},{default:r((()=>[_("div",a,[c(m(g),null,{default:r((()=>[c(m(w),null,{default:r((()=>[c(m(C),{size:"12"},{default:r((()=>[c(m(N),{position:"floating"},{default:r((()=>[b("Phone Number")])),_:1}),c(m(x),{type:"text",placeholder:"Enter a phone number",onIonInput:l[1]||(l[1]=e=>(e=>{const a=e.target.value,l=a.replace(/[^0-9]/g,"");z.value.phoneNumber=l;const n=q.value;void 0!==n&&(n.$el.value=l);let t=!0;L.value=[],9!==z.value.phoneNumber.length&&(t=!1,L.value.push("Phone number must be 9 digits long")),9!==z.value.phoneNumber.length||a.match(/^9/)||(t=!1,L.value.push("Phone number must be a valid Portuguese mobile phone number")),9===z.value.phoneNumber.length&&a===J.value&&(t=!1,L.value.push("You cannot add yourself as a contact")),D.value=t})(e)),maxlength:9,modelValue:z.value.phoneNumber,"onUpdate:modelValue":l[2]||(l[2]=e=>z.value.phoneNumber=e),ref_key:"ionInputPhoneElement",ref:q,disabled:$.value},null,8,["modelValue","disabled"]),L.value.length>0?(i(),k(m(P),{key:0,color:"danger"},{default:r((()=>[b(V(L.value[0]),1)])),_:1})):M("",!0)])),_:1}),c(m(C),null,{default:r((()=>[c(m(N),{position:"floating"},{default:r((()=>[b("Name (optional)")])),_:1}),c(m(x),{type:"text",placeholder:"Enter a name",maxlength:30,modelValue:z.value.name,"onUpdate:modelValue":l[3]||(l[3]=e=>z.value.name=e),disabled:$.value},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),c(m(w),{class:"ion-justify-content-center",style:{"align-self":"self-end"}},{default:r((()=>[c(t,null,{default:r((()=>[c(n,{style:{display:"flex","flex-direction":"column","align-items":"center"}},{default:r((()=>[c(m(A),{disabled:!D.value||$.value,modelValue:z.value.saveContact,"onUpdate:modelValue":l[4]||(l[4]=e=>z.value.saveContact=e)},{default:r((()=>[b("Save contact in my contacts list")])),_:1},8,["disabled","modelValue"]),c(m(h),{disabled:!D.value||$.value,onClick:T},{default:r((()=>[c(m(N),{class:"ion-label-w-spinner"},{default:r((()=>[b("Add Contact "),$.value?(i(),k(m(j),{key:0})):M("",!0)])),_:1})])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])])),_:1})],64)}}},[["__scopeId","data-v-ca61ceab"]]),ne={key:0,style:{height:"100%",width:"100%",display:"flex","align-items":"center","justify-content":"center"}},te={key:1},oe=_("h1",null,"Add New Contact",-1),ue={key:0},se=_("img",{alt:"",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1),ie={key:1};e("default",{__name:"ContactList",setup(e){const a=J(),l=n("axios"),u=t(!0),s=t([]),h={name:{display:"Afonso Cancela"},phones:[{type:Z.Mobile,label:"mobile",number:"918821097"}]},g={name:{display:"João Tavares"},phones:[{type:Z.Mobile,label:"mobile",number:"900000001"}]},w={name:{display:"Miguel Pedrosa Alberto"},phones:[{type:Z.Mobile,label:"mobile",number:"900000002"}]},C={name:{display:"João Miguel Antunes Carvalho da Silva"},phones:[{type:Z.Mobile,label:"mobile",number:"900 000 003"}]},x=async()=>{let e=[];return ee.isNativePlatform()?e=await(async()=>(await ae.getContacts({projection:{name:!0,phones:!0}})).contacts)():(console.log("web"),e=[h,g,w,C]),await U(e)},P=e=>{console.log(e),a.push({path:`/sendMoney/${e.phone}`,query:{name:e.name}})},A=async()=>{const e=await S.create({component:le});e.present();const{data:a,role:l}=await e.onWillDismiss(),n={name:{display:a.name,given:a.name,family:""},phones:[{type:Z.Mobile,label:"mobile",number:a.phoneNumber}]},t=de(n,!0);if("add"===l&&a.saveContact){const e={name:{display:a.name,given:a.name,family:""},phones:[{type:Z.Mobile,label:"mobile",number:a.phoneNumber}]};u.value=!0,ee.isNativePlatform()&&await ae.createContact({contact:e}),s.value.push(t),u.value=!1}P(t)},U=async e=>{console.log(e);const a=e.filter((e=>e.phones)).map((e=>{var a;return null===(a=e.phones[0])||void 0===a?void 0:a.number}));a.forEach(((e,l)=>{a[l]=e.replace(/\s/g,"")}));const l=await ce(a);return e.filter((e=>e.phones)).map((e=>{var a;return de(e,l.includes(null===(a=e.phones[0])||void 0===a?void 0:a.number.replace(/\s/g,"")))}))},de=(e,a=!1)=>({name:e.name.display?e.name.display:"",phone:e.phones[0].number?e.phones[0].number.replace(/\s/g,""):"",isVcard:a}),ce=async e=>(await l.get("/vcards/contacts",{params:{contacts:e}})).data.contacts;return o((async()=>{s.value=await x(),u.value=!1})),(e,a)=>(i(),k(m(O),null,{default:r((()=>[c(m(y),null,{default:r((()=>[c(m(p),null,{default:r((()=>[c(m(v),{slot:"start"},{default:r((()=>[c(m($))])),_:1}),c(m(f),null,{default:r((()=>[b("Contacts")])),_:1})])),_:1})])),_:1}),c(m(E),null,{default:r((()=>[u.value?(i(),d("div",ne,[c(m(j),{style:{width:"100px",height:"100px"}})])):(i(),d("div",te,[_("div",null,[c(m(q),{inset:!0},{default:r((()=>[c(m(z),{onClick:A,button:!0},{default:r((()=>[c(m(D),{color:"success",slot:"start",icon:m(L),size:"large"},null,8,["icon"]),c(m(N),null,{default:r((()=>[oe])),_:1})])),_:1})])),_:1})]),s.value.length>0?(i(),d("div",ue,[c(m(q),{inset:!0},{default:r((()=>[(i(!0),d(I,null,T(s.value,(e=>(i(),k(m(Q),null,{default:r((()=>[e.name&&e.name.length>0&&e.phone&&e.phone.length>0?(i(),k(m(z),{key:0,button:!0,disabled:!e.isVcard,onClick:a=>P(e)},{default:r((()=>[R(c(m(D),{"aria-hidden":"true",icon:m(Y),color:"medium",slot:"end"},null,8,["icon"]),[[F,e.isVcard]]),c(m(X),{"aria-hidden":"true",slot:"start"},{default:r((()=>[se])),_:1}),c(m(N),null,{default:r((()=>[_("h1",null,V(e.name),1),_("p",null,V(e.phone),1)])),_:2},1024)])),_:2},1032,["disabled","onClick"])):M("",!0)])),_:2},1024)))),256))])),_:1})])):(i(),d("div",ie,[c(m(W),null,{default:r((()=>[c(m(B),null,{default:r((()=>[c(m(G),null,{default:r((()=>[b("No contacts")])),_:1}),c(m(H))])),_:1}),c(m(K),null,{default:r((()=>[b("Please add contacts to your contacts list")])),_:1})])),_:1})]))]))])),_:1})])),_:1}))}})}}}));
